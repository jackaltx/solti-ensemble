# ISPConfig Configuration Audit Report

**Audit Date:** {{ audit_timestamp }}  
**Generated by:** Ansible ISPConfig Backup Role  
**Repository:** {{ ispconfig_backup_git.repository_path }}

## Summary

| Metric | Count |
|--------|-------|
| Total Targets | {{ audit_summary.total_targets }} |
| **Changed** | **{{ audit_summary.changed }}** |
| Unchanged | {{ audit_summary.unchanged }} |
| Missing Backup | {{ audit_summary.missing_backup }} |
| Missing Source | {{ audit_summary.missing_source }} |

## Detailed Results

{% for result in audit_results %}
### {{ result.name }}

**Status:** {{ result.status }}  
{% if result.details is defined %}
**Details:** {{ result.details }}  
{% endif %}
{% if result.status == "CHANGED" and result.diff_output is defined and result.diff_output | length > 0 %}

**Changes:**
```diff
{{ result.diff_output }}
```
{% endif %}

---
{% endfor %}

## Status Definitions

- **UNCHANGED**: Configuration matches backup exactly
- **CHANGED**: Configuration differs from backup (see details for change counts)
- **MISSING_BACKUP**: No backup found for this target (run backup first)
- **MISSING_SOURCE**: Source path does not exist on system

## Quick Actions

{% if audit_summary.changed > 0 %}
### üö® Changes Detected

{% for result in audit_results %}
{% if result.status == "CHANGED" %}
- **{{ result.name }}**: {{ result.details }}
{% endif %}
{% endfor %}

**Next Steps:**
1. Review changes above
2. If changes are expected (after ISPConfig update), run backup to update baseline
3. If changes are unexpected, investigate further

### Update Backup After Confirmed Changes
```bash
ansible-playbook site.yml --tags ispconfig_backup
```
{% else %}
### ‚úÖ All Clear

No changes detected in any monitored configurations.
{% endif %}

{% if audit_summary.missing_backup > 0 %}
### ‚ö†Ô∏è Missing Backups

{% for result in audit_results %}
{% if result.status == "MISSING_BACKUP" %}
- **{{ result.name }}**: No backup found
{% endif %}
{% endfor %}

**Action Required:**
```bash
ansible-playbook site.yml --tags ispconfig_backup
```
{% endif %}

---
*Generated automatically by ISPConfig Backup Role*
